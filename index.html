<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Finance Chart</title>
    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        // Check if TradingView library loaded
        if (typeof LightweightCharts === 'undefined') {
            console.error('TradingView Lightweight Charts library failed to load');
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('chart').innerHTML = '<div style="padding: 50px; text-align: center; color: #666;">Chart library failed to load. Please check your internet connection and refresh the page.</div>';
            });
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap');
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            height: 100vh;
            overflow: hidden;
            color: #333;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            box-sizing: border-box;
        }
        
        .main-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 20px);
            max-width: 100%;
            position: relative;
        }
        
        /* Drawer handle */
        .drawer-handle {
            position: fixed;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 25px;
            background: linear-gradient(145deg, #e6e6e6, #ffffff);
            border: 1px solid #d0d0d0;
            border-bottom: none;
            border-radius: 12px 12px 0 0;
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.8),
                inset 0 -1px 2px rgba(0,0,0,0.1),
                0 -2px 8px rgba(0,0,0,0.15);
            cursor: pointer;
            z-index: 100;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .drawer-handle:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.9),
                inset 0 -1px 2px rgba(0,0,0,0.1),
                0 -4px 12px rgba(0,0,0,0.2);
        }
        
        .drawer-handle::before {
            content: '';
            width: 40px;
            height: 4px;
            background: linear-gradient(90deg, #bbb, #ddd, #bbb);
            border-radius: 2px;
            box-shadow: inset 0 1px 1px rgba(0,0,0,0.2);
        }
        
        /* Real drawer container */
        .drawer-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            max-height: 50vh;
            background: linear-gradient(145deg, #8B4513, #A0522D, #CD853F);
            border: 2px solid #654321;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            box-shadow: 
                0 -8px 32px rgba(0,0,0,0.3),
                inset 0 2px 0 rgba(255,255,255,0.1),
                inset 0 -2px 0 rgba(0,0,0,0.2);
            z-index: 90;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow: hidden;
        }
        
        .drawer-container.open {
            transform: translateY(0);
        }
        
        /* Wooden drawer interior */
        .drawer-interior {
            padding: 20px;
            height: 100%;
            overflow-y: auto;
            background: 
                linear-gradient(135deg, #DEB887 0%, #D2B48C 50%, #BC9A6A 100%);
            position: relative;
        }
        
        /* Wood grain texture effect */
        .drawer-interior::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 3px,
                    rgba(139,69,19,0.1) 3px,
                    rgba(139,69,19,0.1) 6px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 1px,
                    rgba(160,82,45,0.05) 1px,
                    rgba(160,82,45,0.05) 2px
                );
            pointer-events: none;
        }
        
        /* Wood knots and imperfections */
        .drawer-interior::after {
            content: '';
            position: absolute;
            top: 20%;
            left: 15%;
            width: 8px;
            height: 12px;
            background: radial-gradient(ellipse, rgba(101,67,33,0.3) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }
        
        /* Drawer contents grid */
        .drawer-contents {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* Control groups as handwritten paper tabs */
        .control-group {
            background: 
                linear-gradient(145deg, #FFFEF7 0%, #F5F5DC 100%),
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 24px,
                    rgba(0,0,255,0.1) 24px,
                    rgba(0,0,255,0.1) 25px
                );
            border: 1px solid #E6E6E6;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 
                0 2px 8px rgba(0,0,0,0.08),
                inset 0 1px 0 rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            transition: all 0.2s ease;
            position: relative;
            transform: rotate(-0.5deg);
            z-index: 3;
        }
        
        .control-group:nth-child(2) {
            transform: rotate(0.3deg);
        }
        
        .control-group:nth-child(3) {
            transform: rotate(-0.2deg);
        }
        
        .control-group:nth-child(4) {
            transform: rotate(0.4deg);
        }
        
        /* Red margin line like school paper */
        .control-group::before {
            content: '';
            position: absolute;
            left: 40px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: rgba(255,0,0,0.3);
        }
        
        .control-group h3 {
            margin: 0 0 12px 0;
            color: #2F4F4F;
            font-size: 16px;
            font-weight: 400;
            font-family: 'Kalam', cursive;
            text-transform: none;
            letter-spacing: 0.5px;
            transform: rotate(-0.5deg);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            position: relative;
            padding-left: 50px;
        }
        
        /* Handwritten underline */
        .control-group h3::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50px;
            right: 20px;
            height: 1px;
            background: #2F4F4F;
            transform: rotate(0.2deg);
            opacity: 0.7;
        }
        
        .input-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 12px 0;
            padding-left: 50px;
        }
        
        label {
            font-weight: 400;
            color: #2F4F4F;
            font-size: 13px;
            font-family: 'Kalam', cursive;
        }
        
        input {
            padding: 6px 10px;
            border: 1px solid #B0B0B0;
            border-radius: 4px;
            background: rgba(255,255,255,0.9);
            width: 100px;
            font-size: 13px;
            font-family: 'Kalam', cursive;
            color: #2F4F4F;
            transition: all 0.2s ease;
        }
        
        input:focus {
            outline: none;
            border-color: #2F4F4F;
            box-shadow: 0 0 0 2px rgba(47,79,79,0.1);
            background: #fff;
        }
        
        button {
            background: linear-gradient(145deg, #F5F5DC, #E6E6E6);
            color: #2F4F4F;
            border: 1px solid #B0B0B0;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 400;
            font-family: 'Kalam', cursive;
            margin: 6px 0;
            margin-left: 50px;
            width: calc(100% - 50px);
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transform: rotate(-0.2deg);
        }
        
        button:active {
            transform: rotate(0deg) translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        /* Close button */
        .drawer-close {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.9);
            border: 1px solid #dee2e6;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #6c757d;
            transition: all 0.2s ease;
            z-index: 10;
        }
        
        .drawer-close:hover {
            background: #fff;
            color: #495057;
            transform: scale(1.1);
        }
        
        /* Pencil, pin, and eraser objects */
        .pencil, .pin, .eraser {
            position: absolute;
            opacity: 1;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .pencil {
            top: 16px;
            left: 78%;
            width: 45px;
            height: 7px;
            background: linear-gradient(90deg, 
                #FFD700 0%, #FFD700 15%,
                #FF6347 15%, #FF6347 20%,
                #F0E68C 20%, #F0E68C 85%,
                #4169E1 85%, #4169E1 90%,
                #2F4F4F 90%, #2F4F4F 100%
            );
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            transform: translateY(150px) rotate(0deg);
        }
        
        .pencil::before {
            content: '';
            position: absolute;
            right: -6px;
            top: 1.5px;
            width: 0;
            height: 0;
            border-left: 6px solid #2F4F4F;
            border-top: 2px solid transparent;
            border-bottom: 2px solid transparent;
        }
        
        .pin {
            top: 12px;
            left: 82%;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle at 30% 30%, #C0C0C0, #808080);
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
            transform: translateY(155px);
        }
        
        .pin::before {
            content: '';
            position: absolute;
            top: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 4px;
            background: #696969;
            border-radius: 1px;
        }
        
        .eraser {
            top: 20px;
            left: 85%;
            width: 12px;
            height: 8px;
            background: linear-gradient(145deg, #FFB6C1, #FF69B4);
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transform: translateY(145px) rotate(0deg);
        }
        
        .drawer-container.open .pencil {
            animation: pencilRollUp 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.3s forwards;
        }
        
        .drawer-container.open .pin {
            animation: pinRollUp 1.0s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.5s forwards;
        }
        
        .drawer-container.open .eraser {
            animation: eraserRollUp 1.1s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.7s forwards;
        }
        
        @keyframes pencilRollUp {
            0% {
                transform: translateY(150px) rotate(0deg);
                z-index: 1;
            }
            49% {
                transform: translateY(20px) rotate(350deg);
                z-index: 1;
            }
            50% {
                transform: translateY(20px) rotate(360deg);
                z-index: 5;
            }
            60% {
                transform: translateY(-20px) rotate(450deg);
                z-index: 5;
            }
            75% {
                transform: translateY(10px) rotate(520deg);
                z-index: 5;
            }
            90% {
                transform: translateY(-2px) rotate(540deg);
                z-index: 5;
            }
            100% {
                transform: translateY(0px) rotate(540deg);
                z-index: 5;
            }
        }
        
        @keyframes pinRollUp {
            0% {
                transform: translateY(155px);
                z-index: 1;
            }
            49% {
                transform: translateY(25px);
                z-index: 1;
            }
            50% {
                transform: translateY(25px);
                z-index: 5;
            }
            60% {
                transform: translateY(-15px);
                z-index: 5;
            }
            75% {
                transform: translateY(8px);
                z-index: 5;
            }
            90% {
                transform: translateY(-1px);
                z-index: 5;
            }
            100% {
                transform: translateY(0px);
                z-index: 5;
            }
        }
        
        @keyframes eraserRollUp {
            0% {
                transform: translateY(145px) rotate(0deg);
                z-index: 1;
            }
            49% {
                transform: translateY(15px) rotate(-260deg);
                z-index: 1;
            }
            50% {
                transform: translateY(15px) rotate(-270deg);
                z-index: 5;
            }
            60% {
                transform: translateY(-18px) rotate(-360deg);
                z-index: 5;
            }
            75% {
                transform: translateY(6px) rotate(-400deg);
                z-index: 5;
            }
            90% {
                transform: translateY(-1px) rotate(-430deg);
                z-index: 5;
            }
            100% {
                transform: translateY(0px) rotate(-450deg);
                z-index: 5;
            }
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }
            
            .main-container {
                height: calc(100vh - 16px);
            }
            
            .chart-container {
                border-width: 2px;
                box-shadow: 4px 4px 0px #8e44ad;
            }
            
            .summary-toggle {
                width: 35px;
                height: 35px;
                font-size: 16px;
                bottom: 10px;
                right: 10px;
            }
            
            .summary-overlay {
                bottom: 55px;
                right: 10px;
                left: 10px;
                min-width: auto;
                max-width: none;
            }
            
            .summary-overlay-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .main-container {
                height: calc(100vh - 10px);
            }
            
            .summary-toggle {
                width: 30px;
                height: 30px;
                font-size: 14px;
                bottom: 8px;
                right: 8px;
            }
            
            .summary-overlay {
                bottom: 45px;
                right: 8px;
                left: 8px;
                padding: 8px;
            }
            
            .summary-overlay-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 4px;
            }
            
            .summary-overlay-card {
                padding: 4px;
            }
            
            .summary-overlay-card h4 {
                font-size: 8px;
            }
            
            .summary-overlay-card .value {
                font-size: 10px;
            }
        }
        
        /* Panel close button */
        .panel-close {
            position: absolute;
            top: 10px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: #e74c3c;
            border: 2px solid #ecf0f1;
            color: #ecf0f1;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 2px 2px 0px #2c3e50;
        }
        
        .panel-close:hover {
            background: #c0392b;
        }
        .control-group {
            background: #2d2d44;
            border: 2px solid #f39c12;
            padding: 10px;
            box-shadow: 4px 4px 0px #27ae60;
            transform: rotate(-0.5deg);
            transition: all 0.2s ease;
        }
        .control-group:hover {
            transform: rotate(0deg);
            box-shadow: 6px 6px 0px #27ae60;
            background: #34495e;
        }
        .control-group h3 {
            margin: 0 0 10px 0;
            color: #ecf0f1;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .input-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
        }
        label {
            font-weight: 600;
            color: #bdc3c7;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        input {
            padding: 6px 8px;
            border: 2px solid #f39c12;
            background: #34495e;
            color: #ecf0f1;
            width: 80px;
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            text-align: center;
        }
        input:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 5px #e74c3c;
            background: #2c3e50;
        }
        button {
            background: linear-gradient(45deg, #e74c3c, #8e44ad);
            color: #ecf0f1;
            border: 2px solid #27ae60;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 4px 0;
            width: 100%;
            box-shadow: 2px 2px 0px #2c3e50;
            transition: all 0.1s ease;
        }
        button:hover {
            transform: translate(-1px, -1px);
            box-shadow: 3px 3px 0px #2c3e50;
            background: linear-gradient(45deg, #c0392b, #7d3c98);
        }
        button:active {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0px #2c3e50;
        }
        .chart-container {
            background: #2c3e50;
            border: 3px solid #f39c12;
            position: relative;
            overflow: visible;
            box-shadow: 8px 8px 0px #8e44ad;
            padding: 0;
            flex: 1; /* Take up remaining space */
            display: flex;
            flex-direction: column;
            min-height: 0; /* Allow flex shrinking */
        }
        
        #chart {
            width: 100%;
            flex: 1;
            min-height: 400px; /* Minimum height for usability */
        }
        
        .chart-header {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
            background: linear-gradient(45deg, #27ae60, #f39c12);
            padding: 6px 10px;
            border: 2px solid #2c3e50;
            box-shadow: 2px 2px 0px #8e44ad;
            max-width: 280px;
            transform: rotate(-1deg);
            pointer-events: auto;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .chart-header:hover {
            transform: rotate(0deg) scale(1.02);
            box-shadow: 4px 4px 0px #8e44ad;
        }
        
        .chart-header::after {
            content: '‚úèÔ∏è';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s ease;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #2c3e50;
        }
        
        .chart-header:hover::after {
            opacity: 1;
        }
        
        .chart-header.top-right {
            top: 10px;
            right: 10px;
            left: auto;
        }
        
        .chart-header.bottom-left {
            bottom: 10px;
            top: auto;
            left: 10px;
        }
        
        .chart-header.bottom-right {
            bottom: 10px;
            right: 10px;
            top: auto;
            left: auto;
        }
        
        .chart-header.bg-solid {
            background: #f39c12;
        }
        
        .chart-header.bg-transparent {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
        }
        
        .chart-header.bg-gradient {
            background: linear-gradient(45deg, #27ae60, #f39c12);
        }
        .chart-header h1 {
            margin: 0;
            font-size: 14px;
            color: #2c3e50;
            line-height: 1.2;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .chart-header p {
            margin: 3px 0 0 0;
            font-size: 8px;
            color: #2c3e50;
            line-height: 1.3;
            font-weight: 600;
            text-transform: uppercase;
        }
        #chart {
            width: 100%;
            height: calc(100% - 20px);
            position: relative;
        }
        
        /* Custom chart overlay for goal markers */
        .chart-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        .goal-vehicle {
            position: absolute;
            font-size: 28px;
            transform: translate(-50%, -50%);
            animation: vehicleArrival 1.5s ease-out;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            filter: drop-shadow(0 0 12px #f39c12);
            z-index: 10;
        }
        
        @keyframes vehicleArrival {
            0% {
                transform: translate(-300%, -50%) scale(0.3);
                opacity: 0;
                filter: drop-shadow(0 0 12px #f39c12) blur(2px);
            }
            30% {
                transform: translate(-150%, -50%) scale(0.8);
                opacity: 0.6;
                filter: drop-shadow(0 0 12px #f39c12) blur(1px);
            }
            70% {
                transform: translate(-75%, -50%) scale(1.1);
                opacity: 0.9;
                filter: drop-shadow(0 0 12px #f39c12);
            }
            85% {
                transform: translate(-45%, -50%) scale(1.05);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
                filter: drop-shadow(0 0 12px #f39c12);
            }
        }
        /* Summary overlay panel */
        .summary-toggle {
            position: absolute;
            bottom: 30px;
            right: 90px;
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, #3498db, #2980b9);
            border: 2px solid #2c3e50;
            border-radius: 50%;
            box-shadow: 3px 3px 0px #8e44ad;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            z-index: 15;
            transition: all 0.2s ease;
        }
        
        .summary-toggle:hover {
            transform: scale(1.05);
            box-shadow: 4px 4px 0px #8e44ad;
        }
        
        .summary-overlay {
            position: absolute;
            bottom: 70px;
            right: 15px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border: 2px solid #3498db;
            border-radius: 8px;
            box-shadow: 4px 4px 0px #8e44ad;
            padding: 16px;
            width: 380px;
            height: auto;
            z-index: 20;
            display: none;
        }
        
        .summary-overlay.show {
            display: block;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .summary-overlay-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #3498db;
        }
        
        .summary-overlay-title {
            color: #3498db;
            font-size: 14px;
            font-weight: bold;
            margin: 0;
        }
        
        .summary-overlay-close {
            background: none;
            border: none;
            color: #bdc3c7;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .summary-overlay-close:hover {
            color: #e74c3c;
        }
        
        .summary-overlay-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 10px;
        }
        
        .summary-overlay-card {
            text-align: center;
            padding: 8px;
            background: linear-gradient(135deg, #34495e, #2c3e50);
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-radius: 6px;
            border: 1px solid #3498db;
        }
        
        .summary-overlay-card h4 {
            margin: 0 0 6px 0;
            color: #bdc3c7;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            height: 14px; /* Fixed height for the heading */
        }
        
        .summary-overlay-card .value {
            font-size: 14px;
            font-weight: 700;
            color: #ecf0f1;
            height: 18px; /* Fixed height for the value */
            line-height: 18px;
        }
            color: #ecf0f1;
            height: 18px; /* Fixed height for the value */
        }
        .summary-card {
            text-align: center;
            padding: 4px 6px;
            background: linear-gradient(135deg, #34495e, #2c3e50);
            border: 1px solid #ecf0f1;
            box-shadow: 1px 1px 0px #27ae60;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            font-size: 11px;
        }
        .summary-card h4 {
            margin: 0 0 4px 0;
            color: #bdc3c7;
            font-size: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 700;
        }
        .summary-card .value {
            font-size: 12px;
            font-weight: 700;
            color: #ecf0f1;
        }
        .loan-item {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            padding: 8px;
            margin: 6px 0;
            border: 2px solid #ecf0f1;
            border-left: 4px solid #e74c3c;
            font-size: 9px;
            box-shadow: 2px 2px 0px #27ae60;
            transition: all 0.2s ease;
            color: #ecf0f1;
        }
        .loan-item:hover {
            box-shadow: 3px 3px 0px #27ae60;
            background: linear-gradient(45deg, #3c5a78, #34495e);
        }
        .remove-loan {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            padding: 4px 8px;
            font-size: 8px;
            margin-top: 4px;
            width: auto;
            border: 1px solid #ecf0f1;
            color: #ecf0f1;
        }
        .remove-loan:hover {
            background: linear-gradient(45deg, #c0392b, #a93226);
        }
        .help-text {
            font-size: 8px;
            color: #95a5a6;
            margin: 4px 0;
            font-style: normal;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .loans-list {
            max-height: 150px;
            overflow-y: auto;
        }
        .loans-list::-webkit-scrollbar {
            width: 6px;
        }
        .loans-list::-webkit-scrollbar-track {
            background: #2c3e50;
        }
        .loans-list::-webkit-scrollbar-thumb {
            background: #f39c12;
            border: 1px solid #27ae60;
        }
        .loans-list:empty::after {
            content: "NO LOANS";
            color: #95a5a6;
            font-style: normal;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(3px);
        }
        .modal-content {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            margin: 5% auto;
            padding: 20px;
            border: 3px solid #f39c12;
            box-shadow: 10px 10px 0px #27ae60;
            width: 70%;
            max-width: 500px;
            max-height: 70vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 2px solid #f39c12;
            padding-bottom: 10px;
        }
        .modal-header h2 {
            color: #ecf0f1;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
        }
        .close {
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            color: #e74c3c;
            transition: all 0.2s ease;
        }
        .close:hover {
            color: #c0392b;
            transform: scale(1.1);
        }
        .override-row {
            display: grid;
            grid-template-columns: 1fr 1.5fr 60px;
            gap: 10px;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: linear-gradient(45deg, #34495e, #2c3e50);
            border: 2px solid #ecf0f1;
            box-shadow: 2px 2px 0px #27ae60;
            color: #ecf0f1;
            font-weight: 600;
            font-size: 9px;
        }
        
        .override-row .override-details {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .override-row .override-details div {
            font-size: 11px;
        }
        
        .override-row .override-details .net-worth {
            font-weight: bold;
            color: #3498db;
            margin-top: 3px;
        }
        .override-row input {
            width: auto;
            background: #2c3e50;
            color: #ecf0f1;
            border: 1px solid #f39c12;
            font-size: 9px;
        }
        .remove-override {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            padding: 4px 6px;
            font-size: 8px;
            width: auto;
            border: 1px solid #ecf0f1;
            color: #ecf0f1;
        }
        
        /* Custom RV icon for chart markers */
        .rv-marker {
            position: relative;
            display: inline-block;
            width: 24px;
            height: 12px;
            background: linear-gradient(45deg, #ecf0f1, #bdc3c7);
            border: 2px solid #2c3e50;
            border-radius: 4px 8px 4px 4px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .rv-marker::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 2px;
            width: 8px;
            height: 8px;
            background: #34495e;
            border: 1px solid #2c3e50;
            border-radius: 4px 0 0 4px;
        }
        
        .rv-marker::after {
            content: '';
            position: absolute;
            right: 2px;
            bottom: -4px;
            width: 4px;
            height: 4px;
            background: #2c3e50;
            border-radius: 50%;
            box-shadow: -8px 0 0 #2c3e50, -16px 0 0 #2c3e50;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Drawer Handle -->
        <div class="drawer-handle" onclick="toggleDrawer()"></div>

        <!-- Real Drawer Container -->
        <div class="drawer-container" id="drawer">
            <div class="drawer-interior">
                <div class="pencil"></div>
                <div class="pin"></div>
                <div class="eraser"></div>
                <div class="drawer-close" onclick="closeDrawer()">√ó</div>
                
                <div class="drawer-contents">
                    <div class="control-group">
                        <h3>üí∞ Savings & Interest</h3>
                        <div class="input-row">
                            <label>Start Date:</label>
                            <input type="month" id="startDate" value="">
                        </div>
                        <div class="input-row">
                            <label>Initial Amount ($):</label>
                            <input type="number" id="initialAmount" value="10000" min="0">
                        </div>
                        <div class="input-row">
                            <label>Monthly Savings ($):</label>
                            <input type="number" id="monthlySavings" value="500" min="0">
                        </div>
                        <div class="input-row">
                            <label>Interest Rate (%):</label>
                            <input type="number" id="interestRate" value="7" min="0" max="50" step="0.1">
                        </div>
                        <div class="input-row">
                            <label>Time Period (years):</label>
                            <input type="number" id="timePeriod" value="20" min="1" max="50">
                        </div>
                        <div class="input-row">
                            <label>Goal Amount ($):</label>
                            <input type="number" id="goalAmount" placeholder="Optional" min="0">
                        </div>
                        <button onclick="showNetWorthOverrides()">üìà Net Worth Overrides</button>
                    </div>

                    <div class="control-group">
                        <h3>üè† Add Loan</h3>
                        <div class="input-row">
                            <label>Amount ($):</label>
                            <input type="number" id="loanAmount" value="200000" min="0">
                        </div>
                        <div class="input-row">
                            <label>Rate (%):</label>
                            <input type="number" id="loanRate" value="4.5" min="0" max="30" step="0.1">
                        </div>
                        <div class="input-row">
                            <label>Term (years):</label>
                            <input type="number" id="loanTerm" value="30" min="1" max="50">
                        </div>
                        <div class="input-row">
                            <label>Start Date:</label>
                            <input type="month" id="loanStartDate" value="">
                        </div>
                        <div class="input-row">
                            <label>Payment ($):</label>
                            <input type="number" id="loanMonthlyPayment" placeholder="Auto-calc" min="0">
                        </div>
                        <button onclick="addLoan()">Add Loan</button>
                    </div>

                    <div class="control-group">
                        <h3>üìã Active Loans</h3>
                        <div class="loans-list" id="loansList">
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <h3>‚ö° Quick Actions</h3>
                        <button onclick="updateChart()">üìä Refresh Chart</button>
                        <button onclick="showChartHeaderModal()">‚úèÔ∏è Edit Chart Header</button>
                        <button onclick="clearAllLoans()">üóëÔ∏è Clear All Loans</button>
                        <button onclick="exportToJSON()">üì§ Export to JSON</button>
                        <button onclick="document.getElementById('jsonFileInput').click()">üì• Import JSON</button>
                        <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="importFromJSON(event)">
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart (Full Height) -->
        <div class="chart-container">
            <div class="chart-header" onclick="showChartHeaderModal()">
                <h1>Family Finance Growth</h1>
                <p>Interactive financial projection with compound interest & loan calculations</p>
            </div>
            <div id="chart">
                <div class="chart-overlay" id="chartOverlay"></div>
            </div>
            
            <!-- Summary Toggle Button -->
            <div class="summary-toggle" onclick="toggleSummaryOverlay()">üîç</div>
            
            <!-- Summary Overlay Panel -->
            <div class="summary-overlay" id="summaryOverlay">
                <div class="summary-overlay-header">
                    <h3 class="summary-overlay-title">üìä Financial Summary</h3>
                    <button class="summary-overlay-close" onclick="closeSummaryOverlay()">&times;</button>
                </div>
                <div class="summary-overlay-grid" id="summaryOverlayContent">
                    <!-- Summary cards will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Net Worth Overrides Modal -->
    <div id="netWorthOverridesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìà Financial Overrides</h2>
                <span class="close" onclick="closeNetWorthOverrides()">&times;</span>
            </div>
            <div style="margin-bottom: 15px;">
                <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-bottom: 10px;">
                    <label>Override Date:</label>
                    <input type="month" id="overrideDate" style="width: 150px;">
                    <label>Total Savings ($):</label>
                    <input type="number" id="overrideSavings" placeholder="Savings amount" style="width: 120px;">
                    <label>Total Loan Balance ($):</label>
                    <input type="number" id="overrideLoanBalance" placeholder="Loan balance" style="width: 120px;">
                    <button onclick="addNetWorthOverrideFromForm()">+ Add</button>
                </div>
                <div class="help-text">Override both savings and loan balance for specific months (asset purchases, windfalls, market changes, etc.)</div>
            </div>
            <div id="netWorthOverridesList">
                <!-- Override rows will be populated here -->
            </div>
            <div style="margin-top: 20px; text-align: right;">
                <button onclick="closeNetWorthOverrides()" style="background: #28a745;">Done</button>
            </div>
        </div>
    </div>

    <!-- Chart Header Edit Modal -->
    <div id="chartHeaderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä Edit Chart Header</h2>
                <span class="close" onclick="closeChartHeaderModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="input-row">
                    <label>Display Header:</label>
                    <select id="chartHeaderVisible" style="width: 120px; font-family: 'Kalam', cursive;">
                        <option value="true">Show</option>
                        <option value="false">Hide</option>
                    </select>
                </div>
                <div class="input-row">
                    <label>Title:</label>
                    <input type="text" id="chartTitle" value="Family Finance Growth" style="width: 200px;">
                </div>
                <div class="input-row">
                    <label>Subtitle:</label>
                    <input type="text" id="chartSubtitle" value="Interactive financial projection with compound interest & loan calculations" style="width: 200px;">
                </div>
                <div class="input-row">
                    <label>Background:</label>
                    <select id="chartHeaderBg" style="width: 120px; font-family: 'Kalam', cursive;">
                        <option value="gradient">Gradient</option>
                        <option value="solid">Solid</option>
                        <option value="transparent">Transparent</option>
                    </select>
                </div>
                <div class="input-row">
                    <label>Position:</label>
                    <select id="chartHeaderPos" style="width: 120px; font-family: 'Kalam', cursive;">
                        <option value="top-left">Top Left</option>
                        <option value="top-right">Top Right</option>
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-right">Bottom Right</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="updateChartHeader(); closeChartHeaderModal();">Apply Changes</button>
                <button onclick="closeChartHeaderModal();" style="background: linear-gradient(145deg, #95a5a6, #7f8c8d);">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Load JavaScript modules in dependency order -->
    <script src="js/utilities.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/chart-manager.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/ui-manager.js"></script>
    <script src="js/override-manager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
